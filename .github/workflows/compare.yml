name: Check Unfollowers
on: [push]

jobs:
  compare:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Run Comparison
        run: |
          python3 -c "
          import re
          import os
          def extract_usernames(filename):
              if not os.path.exists(filename): return set()
              with open(filename, 'r', encoding='utf-8') as f:
                  return set(re.findall(r'href=\"https://www\.instagram\.com/([^/\"?]+)', f.read()))
          following = extract_usernames('following.html')
          followers = extract_usernames('followers_1.html')
          with open('result.txt', 'w') as f:
              for user in sorted(following - followers): f.write(user + '\n')
          "
      - name: Upload Result
        uses: actions/upload-artifact@v4
        with:
          name: unfollowers-list
          path: result.txt
