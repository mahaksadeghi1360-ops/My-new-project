name: Check Unfollowers
on: [push]

jobs:
  compare:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Extract and Show
        run: |
          python3 -c "
          import re, os
          def find_all(fn):
              if not os.path.exists(fn): return set()
              with open(fn, 'r', encoding='utf-8') as f:
                  data = f.read()
              # پیدا کردن یوزرنیم از لینک‌ها و متن‌ها
              return set(re.findall(r'instagram\.com/([a-zA-Z0-9._]+)|>([a-zA-Z0-9._]+)</a>', data))
          
          ing_raw = find_all('following.html')
          ers_raw = find_all('followers_1.html')
          
          # تمیز کردن یوزرنیم‌ها
          ing = {u[0] or u[1] for u in ing_raw if (u[0] or u[1]) and len(u[0] or u[1]) > 2}
          ers = {u[0] or u[1] for u in ers_raw if (u[0] or u[1]) and len(u[0] or u[1]) > 2}
          
          blacklist = {'explore', 'reels', 'direct', 'stories', 'p', 'tv', 'about', 'help'}
          ing = {u for u in ing if u not in blacklist}
          ers = {u for u in ers if u not in blacklist}

          print(f'\nFollowing: {len(ing)} | Followers: {len(ers)}')
          print('-' * 20)
          unf = sorted(ing - ers)
          for u in unf: print(f'Unfollower: {u}')
          "
